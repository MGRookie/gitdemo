"use strict";!function(n,s){function t(t){this.wrap=t,this.dataList=[],this.indexObj=null,this.rotateTimer=null}t.prototype={init:function(){this.getDom(),this.getData("../mock/data.json"),this.seekBar()},getDom:function(){this.record=document.querySelector(".songImg img"),this.controlBtns=document.querySelectorAll(".control li")},getData:function(t){var e=this;n.ajax({type:"GET",url:t,success:function(t){e.dataList=t,e.listPlay(),e.indexObj=new s.controlIndex(t.length),e.loadMusic(e.indexObj.index),e.musicControl()},error:function(){console.log("数据请求失败")}})},loadMusic:function(t){s.render(this.dataList[t]),s.music.load(this.dataList[t].audio),s.seekBar.renderAllTime(this.dataList[t].duration),n(this.record).data("deg",0),this.record.style.transform="rotate(0deg)","play"==s.music.status?(s.music.play(),s.seekBar.clear(),s.seekBar.start(),this.imgRotate(0)):"pause"==s.music.status&&(s.music.pause(),s.seekBar.clear())},musicControl:function(){var i=this;this.controlBtns[1].addEventListener("touchend",function(){i.loadMusic(i.indexObj.prev()),i.list.changeSelect(i.indexObj.index)}),this.controlBtns[3].addEventListener("touchend",function(){i.loadMusic(i.indexObj.next()),i.list.changeSelect(i.indexObj.index)}),this.controlBtns[2].addEventListener("touchend",function(){"play"==s.music.status?(s.music.pause(),s.seekBar.stop(),s.music.status="pause",n(this).addClass("icon-bofang").removeClass("icon-zanting"),clearInterval(i.rotateTimer)):(s.music.play(),s.music.status="play",n(this).addClass("icon-zanting").removeClass("icon-bofang"),i.imgRotate(n(i.record).data("deg")),s.seekBar.start())}),this.controlBtns[4].addEventListener("touchend",function(){i.list.slideUp()}),n(".list .close").on("touchend",function(){i.list.slideDown()}),i.list.musicList.forEach(function(t,e){t.on("touchend",function(){i.indexObj.index!=e&&(i.indexObj.index=e,i.loadMusic(i.indexObj.index),i.list.slideDown())})}),s.music.end(function(){console.log("this over"),i.loadMusic(i.indexObj.prev()),i.list.changeSelect(i.indexObj.index)})},imgRotate:function(t){var e=this;clearInterval(this.rotateTimer),this.rotateTimer=setInterval(function(){t=+t+.2,e.record.style.transform="rotate("+t+"deg)",n(e.record).data("deg",t)},1e3/60)},listPlay:function(){this.list=s.listControl(this.dataList,this.wrap)},seekBar:function(){this.seekbar=s.seekBar}},new t(document.querySelector(".wrap")).init()}(window.Zepto,window.player);